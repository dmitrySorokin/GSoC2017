<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">ol.lst-kix_9gjs5k5t9u03-8{list-style-type:none}ol.lst-kix_9gjs5k5t9u03-6{list-style-type:none}ol.lst-kix_9gjs5k5t9u03-7{list-style-type:none}ol.lst-kix_9gjs5k5t9u03-4{list-style-type:none}ol.lst-kix_9gjs5k5t9u03-5{list-style-type:none}ol.lst-kix_9gjs5k5t9u03-2{list-style-type:none}ol.lst-kix_9gjs5k5t9u03-2.start{counter-reset:lst-ctn-kix_9gjs5k5t9u03-2 0}ol.lst-kix_9gjs5k5t9u03-3{list-style-type:none}ol.lst-kix_9gjs5k5t9u03-0{list-style-type:none}ol.lst-kix_9gjs5k5t9u03-1{list-style-type:none}.lst-kix_p18g0ikrd5da-4>li:before{content:"\0025cb  "}.lst-kix_p18g0ikrd5da-6>li:before{content:"\0025cf  "}.lst-kix_9gjs5k5t9u03-0>li{counter-increment:lst-ctn-kix_9gjs5k5t9u03-0}.lst-kix_7svtqku904fn-8>li:before{content:"\0025a0  "}.lst-kix_p18g0ikrd5da-5>li:before{content:"\0025a0  "}.lst-kix_7svtqku904fn-6>li:before{content:"\0025cf  "}.lst-kix_p18g0ikrd5da-8>li:before{content:"\0025a0  "}ol.lst-kix_9gjs5k5t9u03-5.start{counter-reset:lst-ctn-kix_9gjs5k5t9u03-5 0}.lst-kix_7svtqku904fn-7>li:before{content:"\0025cb  "}.lst-kix_p18g0ikrd5da-7>li:before{content:"\0025cb  "}ul.lst-kix_7svtqku904fn-6{list-style-type:none}ul.lst-kix_7svtqku904fn-5{list-style-type:none}.lst-kix_9gjs5k5t9u03-0>li:before{content:"" counter(lst-ctn-kix_9gjs5k5t9u03-0,decimal) ". "}ul.lst-kix_7svtqku904fn-8{list-style-type:none}ul.lst-kix_7svtqku904fn-7{list-style-type:none}ul.lst-kix_7svtqku904fn-2{list-style-type:none}ul.lst-kix_7svtqku904fn-1{list-style-type:none}ul.lst-kix_7svtqku904fn-4{list-style-type:none}ul.lst-kix_7svtqku904fn-3{list-style-type:none}.lst-kix_9gjs5k5t9u03-2>li{counter-increment:lst-ctn-kix_9gjs5k5t9u03-2}ul.lst-kix_7svtqku904fn-0{list-style-type:none}.lst-kix_ugnsl1wzccz6-8>li:before{content:"\0025a0  "}ul.lst-kix_p18g0ikrd5da-1{list-style-type:none}ul.lst-kix_p18g0ikrd5da-2{list-style-type:none}.lst-kix_ugnsl1wzccz6-4>li:before{content:"\0025cb  "}ul.lst-kix_p18g0ikrd5da-0{list-style-type:none}.lst-kix_ugnsl1wzccz6-3>li:before{content:"\0025cf  "}.lst-kix_ugnsl1wzccz6-5>li:before{content:"\0025a0  "}ol.lst-kix_9gjs5k5t9u03-8.start{counter-reset:lst-ctn-kix_9gjs5k5t9u03-8 0}.lst-kix_ugnsl1wzccz6-6>li:before{content:"\0025cf  "}.lst-kix_ugnsl1wzccz6-7>li:before{content:"\0025cb  "}ol.lst-kix_9gjs5k5t9u03-3.start{counter-reset:lst-ctn-kix_9gjs5k5t9u03-3 0}ul.lst-kix_wm88o6xry0j-6{list-style-type:none}ul.lst-kix_wm88o6xry0j-5{list-style-type:none}ul.lst-kix_wm88o6xry0j-8{list-style-type:none}ul.lst-kix_wm88o6xry0j-7{list-style-type:none}ul.lst-kix_wm88o6xry0j-2{list-style-type:none}ul.lst-kix_wm88o6xry0j-1{list-style-type:none}ul.lst-kix_wm88o6xry0j-4{list-style-type:none}ul.lst-kix_wm88o6xry0j-3{list-style-type:none}.lst-kix_9gjs5k5t9u03-4>li{counter-increment:lst-ctn-kix_9gjs5k5t9u03-4}ul.lst-kix_wm88o6xry0j-0{list-style-type:none}.lst-kix_9gjs5k5t9u03-1>li{counter-increment:lst-ctn-kix_9gjs5k5t9u03-1}ul.lst-kix_ugnsl1wzccz6-0{list-style-type:none}ul.lst-kix_ugnsl1wzccz6-1{list-style-type:none}ul.lst-kix_ugnsl1wzccz6-4{list-style-type:none}ul.lst-kix_ugnsl1wzccz6-5{list-style-type:none}ul.lst-kix_ugnsl1wzccz6-2{list-style-type:none}ul.lst-kix_ugnsl1wzccz6-3{list-style-type:none}.lst-kix_9gjs5k5t9u03-7>li{counter-increment:lst-ctn-kix_9gjs5k5t9u03-7}.lst-kix_9gjs5k5t9u03-6>li{counter-increment:lst-ctn-kix_9gjs5k5t9u03-6}.lst-kix_9gjs5k5t9u03-8>li{counter-increment:lst-ctn-kix_9gjs5k5t9u03-8}ul.lst-kix_xx4t39gbjh52-7{list-style-type:none}ul.lst-kix_xx4t39gbjh52-8{list-style-type:none}ul.lst-kix_xx4t39gbjh52-5{list-style-type:none}ul.lst-kix_xx4t39gbjh52-6{list-style-type:none}ul.lst-kix_u6m3k3s7127-7{list-style-type:none}ul.lst-kix_u6m3k3s7127-6{list-style-type:none}.lst-kix_9gjs5k5t9u03-5>li{counter-increment:lst-ctn-kix_9gjs5k5t9u03-5}ul.lst-kix_u6m3k3s7127-8{list-style-type:none}.lst-kix_ugnsl1wzccz6-1>li:before{content:"\0025cb  "}ul.lst-kix_u6m3k3s7127-3{list-style-type:none}ul.lst-kix_u6m3k3s7127-2{list-style-type:none}.lst-kix_ugnsl1wzccz6-0>li:before{content:"\0025cf  "}.lst-kix_ugnsl1wzccz6-2>li:before{content:"\0025a0  "}ul.lst-kix_p18g0ikrd5da-7{list-style-type:none}ul.lst-kix_u6m3k3s7127-5{list-style-type:none}ul.lst-kix_p18g0ikrd5da-8{list-style-type:none}.lst-kix_wm88o6xry0j-1>li:before{content:"\0025cb  "}.lst-kix_wm88o6xry0j-3>li:before{content:"\0025cf  "}ul.lst-kix_u6m3k3s7127-4{list-style-type:none}ul.lst-kix_p18g0ikrd5da-5{list-style-type:none}ol.lst-kix_9gjs5k5t9u03-1.start{counter-reset:lst-ctn-kix_9gjs5k5t9u03-1 0}ul.lst-kix_p18g0ikrd5da-6{list-style-type:none}ul.lst-kix_p18g0ikrd5da-3{list-style-type:none}ul.lst-kix_u6m3k3s7127-1{list-style-type:none}ul.lst-kix_p18g0ikrd5da-4{list-style-type:none}.lst-kix_wm88o6xry0j-0>li:before{content:"\0025cf  "}.lst-kix_wm88o6xry0j-4>li:before{content:"\0025cb  "}ul.lst-kix_u6m3k3s7127-0{list-style-type:none}ol.lst-kix_9gjs5k5t9u03-4.start{counter-reset:lst-ctn-kix_9gjs5k5t9u03-4 0}.lst-kix_wm88o6xry0j-2>li:before{content:"\0025a0  "}.lst-kix_xx4t39gbjh52-0>li:before{content:"\0025cf  "}.lst-kix_xx4t39gbjh52-1>li:before{content:"\0025cb  "}.lst-kix_wm88o6xry0j-8>li:before{content:"\0025a0  "}.lst-kix_xx4t39gbjh52-4>li:before{content:"\0025cb  "}.lst-kix_xx4t39gbjh52-5>li:before{content:"\0025a0  "}.lst-kix_wm88o6xry0j-5>li:before{content:"\0025a0  "}.lst-kix_wm88o6xry0j-7>li:before{content:"\0025cb  "}.lst-kix_xx4t39gbjh52-6>li:before{content:"\0025cf  "}ol.lst-kix_9gjs5k5t9u03-7.start{counter-reset:lst-ctn-kix_9gjs5k5t9u03-7 0}.lst-kix_wm88o6xry0j-6>li:before{content:"\0025cf  "}.lst-kix_u6m3k3s7127-6>li:before{content:"\0025cf  "}.lst-kix_u6m3k3s7127-8>li:before{content:"\0025a0  "}.lst-kix_9gjs5k5t9u03-4>li:before{content:"" counter(lst-ctn-kix_9gjs5k5t9u03-4,lower-latin) ". "}.lst-kix_9gjs5k5t9u03-3>li{counter-increment:lst-ctn-kix_9gjs5k5t9u03-3}.lst-kix_u6m3k3s7127-7>li:before{content:"\0025cb  "}ul.lst-kix_xx4t39gbjh52-3{list-style-type:none}.lst-kix_9gjs5k5t9u03-2>li:before{content:"" counter(lst-ctn-kix_9gjs5k5t9u03-2,lower-roman) ". "}.lst-kix_9gjs5k5t9u03-3>li:before{content:"" counter(lst-ctn-kix_9gjs5k5t9u03-3,decimal) ". "}ul.lst-kix_xx4t39gbjh52-4{list-style-type:none}ul.lst-kix_xx4t39gbjh52-1{list-style-type:none}.lst-kix_xx4t39gbjh52-3>li:before{content:"\0025cf  "}ul.lst-kix_xx4t39gbjh52-2{list-style-type:none}.lst-kix_xx4t39gbjh52-2>li:before{content:"\0025a0  "}.lst-kix_9gjs5k5t9u03-1>li:before{content:"" counter(lst-ctn-kix_9gjs5k5t9u03-1,lower-latin) ". "}ul.lst-kix_xx4t39gbjh52-0{list-style-type:none}ol.lst-kix_9gjs5k5t9u03-0.start{counter-reset:lst-ctn-kix_9gjs5k5t9u03-0 0}.lst-kix_7svtqku904fn-2>li:before{content:"\0025a0  "}.lst-kix_u6m3k3s7127-0>li:before{content:"\0025cf  "}.lst-kix_7svtqku904fn-0>li:before{content:"\0025cf  "}.lst-kix_7svtqku904fn-4>li:before{content:"\0025cb  "}.lst-kix_7svtqku904fn-1>li:before{content:"\0025cb  "}.lst-kix_7svtqku904fn-5>li:before{content:"\0025a0  "}.lst-kix_u6m3k3s7127-3>li:before{content:"\0025cf  "}.lst-kix_p18g0ikrd5da-2>li:before{content:"\0025a0  "}.lst-kix_u6m3k3s7127-4>li:before{content:"\0025cb  "}.lst-kix_9gjs5k5t9u03-5>li:before{content:"" counter(lst-ctn-kix_9gjs5k5t9u03-5,lower-roman) ". "}.lst-kix_7svtqku904fn-3>li:before{content:"\0025cf  "}.lst-kix_p18g0ikrd5da-3>li:before{content:"\0025cf  "}.lst-kix_u6m3k3s7127-5>li:before{content:"\0025a0  "}.lst-kix_xx4t39gbjh52-8>li:before{content:"\0025a0  "}.lst-kix_9gjs5k5t9u03-6>li:before{content:"" counter(lst-ctn-kix_9gjs5k5t9u03-6,decimal) ". "}.lst-kix_9gjs5k5t9u03-7>li:before{content:"" counter(lst-ctn-kix_9gjs5k5t9u03-7,lower-latin) ". "}ol.lst-kix_9gjs5k5t9u03-6.start{counter-reset:lst-ctn-kix_9gjs5k5t9u03-6 0}.lst-kix_xx4t39gbjh52-7>li:before{content:"\0025cb  "}.lst-kix_9gjs5k5t9u03-8>li:before{content:"" counter(lst-ctn-kix_9gjs5k5t9u03-8,lower-roman) ". "}.lst-kix_p18g0ikrd5da-1>li:before{content:"\0025cb  "}ul.lst-kix_ugnsl1wzccz6-8{list-style-type:none}ul.lst-kix_ugnsl1wzccz6-6{list-style-type:none}ul.lst-kix_ugnsl1wzccz6-7{list-style-type:none}.lst-kix_p18g0ikrd5da-0>li:before{content:"\0025cf  "}.lst-kix_u6m3k3s7127-2>li:before{content:"\0025a0  "}.lst-kix_u6m3k3s7127-1>li:before{content:"\0025cb  "}ol{margin:0;padding:0}table td,table th{padding:0}.c17{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:20pt;font-family:"Arial";font-style:normal}.c2{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c13{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:16pt;font-family:"Arial";font-style:normal}.c0{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:26pt;font-family:"Arial";font-style:normal}.c3{color:#434343;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:14pt;font-family:"Arial";font-style:normal}.c4{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c1{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:justify}.c6{padding-top:20pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;text-align:left}.c10{padding-top:18pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;text-align:left}.c9{padding-top:16pt;padding-bottom:4pt;line-height:1.15;page-break-after:avoid;text-align:left}.c16{padding-top:0pt;padding-bottom:3pt;line-height:1.15;page-break-after:avoid;text-align:center}.c8{padding-top:18pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;text-align:justify}.c14{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c7{margin-left:36pt;padding-left:0pt}.c12{padding:0;margin:0}.c11{text-indent:36pt}.c5{height:11pt}.c15{margin-left:36pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c14"><p class="c16 title" id="h.c9wc3e5szaqv"><span class="c0">New methods for trajectory integration in Geant4</span></p><h2 class="c10" id="h.ji6a1k2h3c4l"><span class="c13">Introduction / context</span></h2><p class="c4"><span class="c2">Purpose of the &lsquo;Integration&rsquo; part of the field propagation module in Geant4.</span></p><p class="c4"><span class="c2">Relative importance in terms of simulation time in the case of typical fields of today&rsquo;s (complex) High Energy Physics experiments.</span></p><p class="c4 c5"><span class="c2"></span></p><p class="c4"><span class="c2">Challenges:</span></p><ul class="c12 lst-kix_7svtqku904fn-0 start"><li class="c4 c7"><span class="c2">very robust integration of different equations (with a user provided field) for different length scales, without failures. &nbsp; </span></li><li class="c4 c7"><span class="c2">high cost of field evaluation, but also change of momentum (currently only at end of a &lsquo;physical&rsquo; step) due to interactions. &nbsp;This imposes some limit on the ability to reuse previous derivatives (multi-step methods.) </span></li><li class="c4 c7"><span class="c2">need to find the intersection point between a curved trajectory and the surfaces of user&rsquo;s volumes - which we seek to address using RK methods with interpolation to provide arbitrary intermediate points.</span></li><li class="c4 c7"><span class="c2">Observed that the step size sometimes oscillates, leading to the idea to try different step-size control methods.</span></li></ul><p class="c4 c5"><span class="c2"></span></p><p class="c4"><span class="c2">Purpose(s) of this year&rsquo;s GSoC project - making clear mention of each initiative: new step-size control algorithms, steppers for oscillatory problems and the revision of drivers for RK to enable use of FSAL (and pave way for interpolation).</span></p><h2 class="c10" id="h.k6iycjvb8b54"><span class="c13">Part 1: New methods for step size control </span></h2><h3 class="c9" id="h.ei5tjv2hj1fp"><span>Step size control algorithms</span><span class="c3">&nbsp;</span></h3><p class="c1"><span class="c2">Context</span></p><ul class="c12 lst-kix_ugnsl1wzccz6-0 start"><li class="c1 c7"><span class="c2">How integration with adaptive step size is performed</span></li><li class="c1 c7"><span class="c2">What are step size algorithms (Standard, Gustafsson)</span></li></ul><p class="c1"><span class="c2">The work done</span></p><p class="c1 c15"><span class="c2">Show code example of usage of different step size control algorithms along with G4MagInt_Driver</span></p><p class="c1"><span class="c2">Results</span></p><ul class="c12 lst-kix_u6m3k3s7127-0 start"><li class="c1 c7"><span class="c2">benchmarks in a uniform, quadrupole and CMS magnetic fields</span></li><li class="c1 c7"><span class="c2">test NTST </span></li></ul><p class="c1 c5"><span class="c2"></span></p><h2 class="c8" id="h.hpy4m1gxmblg"><span>Part 2 - </span><span>Methods adapted for oscillatory problems</span></h2><p class="c4"><span class="c2">Context</span></p><ul class="c12 lst-kix_p18g0ikrd5da-0 start"><li class="c4 c7"><span class="c2">What are adapted Runge-Kutta methods</span></li></ul><p class="c4"><span class="c2">Results</span></p><ul class="c12 lst-kix_xx4t39gbjh52-0 start"><li class="c4 c7"><span class="c2">Show benchmarks of the different implementations of the Bettis functions. </span></li><li class="c4 c7"><span class="c2">Show comparison of Helix, classical RK4 and adapted RK4 methods in a uniform, quadrupole and CMS magnetic fields.</span></li><li class="c4 c7"><span class="c2">Show results for the NTST test (event time, number of field evaluations) </span></li></ul><p class="c4 c5"><span class="c2"></span></p><h2 class="c10" id="h.r0eql2g8z4cl"><span class="c13">Part 3 - Using interpolation and FSAL in integration</span></h2><h3 class="c9" id="h.83zs2yqccpcv"><span class="c3">Library design - the revised design</span></h3><p class="c1"><span class="c2">Discuss main classes and methods (Stepper, Driver, ChordFinder, IntersectionLocator). </span></p><p class="c1"><span class="c2">Show uml diagram. Describe the integration process: </span></p><p class="c1"><span class="c2">QuickAdvance (to find the step length) -&gt; AccurateAdvance (integrate satisfying error criterion) -&gt; intersection location. </span></p><p class="c1"><span class="c2">Introduce virtual base driver class which enables usage of different driver algorithms: Bulirsch-Stoer, Standard (G4MagInt_Driver), FSAL</span></p><h3 class="c9" id="h.4zul7yhqfrhs"><span>FSAL steppers</span></h3><p class="c1"><span class="c2">Context </span></p><ul class="c12 lst-kix_wm88o6xry0j-0 start"><li class="c1 c7"><span class="c2">What is the FSAL property of a Runge-Kutta method. </span></li><li class="c1 c7"><span class="c2">How can it be used in the integration scheme (described in the first section / intro ). </span></li></ul><p class="c1"><span class="c2">The work done</span></p><p class="c1 c11"><span class="c2">Show code example of a FSAL stepper and it&rsquo;s usage.</span></p><p class="c1"><span class="c2">Results</span></p><p class="c1 c11"><span class="c2">Present benchmarks. (test NTST, something else...)</span></p><p class="c1 c5"><span class="c2"></span></p><h1 class="c6" id="h.7dea2ql61j3l"><span class="c17">Sections for Geant4 Meeting Report only</span></h1><h2 class="c10" id="h.tpuz86yyorrt"><span>Interpolation</span></h2><p class="c1"><span class="c2">Introduce interpolation property of a Runge-Kutta method. Discuss applications of interpolation in the integration process. </span></p><p class="c1"><span class="c2">Show code example of an interpolation driver and it&rsquo;s usage. </span></p><p class="c1"><span class="c2">Present benchmarks (test NTST, something else...)</span></p></body></html>